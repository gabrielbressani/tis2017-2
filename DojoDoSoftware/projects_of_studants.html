<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="Visualizarport" content="width=device-width, initial-scale=1.0">

    <title>Dojo do Software | Projetos</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">

    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <!-- Toastr style -->
    <link href="css/plugins/toastr/toastr.min.css" rel="stylesheet">

    <!-- Checkbox style -->
    <link href="css/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet">
    
    <!-- Chosen -->
    <link href="css/plugins/chosen/bootstrap-chosen.css" rel="stylesheet">

</head>

<body>

    <div id="wrapper">

    <nav class="navbar-default navbar-static-side" role="navigation">
        <div class="sidebar-collapse">
            <ul class="nav metismenu" id="side-menu">
                <li class="nav-header">
                    <div class="dropdown profile-element"> 
                        <span>
                            <img alt="image" class="img-circle" src="img/a4.jpg" style="width: 50px;">
                        </span>
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                            <span class="clear"> <span class="block m-t-xs"> <strong class="font-bold">
                                Betão
                            </strong>
                             </span> <span class="text-muted text-xs block">Configurações <b class="caret"></b></span> </span> </a>
                        <ul class="dropdown-menu animated fadeInRight m-t-xs">
                            <li><a href="profile.html">Profile</a></li>
                            <li><a href="contacts.html">Contacts</a></li>
                            <li><a href="mailbox.html">Mailbox</a></li>
                            <li class="divider"></li>
                            <li><a href="login.html">Logout</a></li>
                        </ul>
                    </div>
                    <div class="logo-element">
                        &nbsp;
                    </div>
                </li>
                <li>
                    <a href="#">
                        <i class="fa fa-th-large"></i> 
                        <span class="nav-label">
                            Dashboard
                        </span>
                    </a>
                </li>
                <li class="active">
                    <a href="projects_of_studants.html">
                        <i class="fa fa-cube"></i> 
                        <span class="nav-label">
                            Projetos
                        </span>
                    </a>
                </li>
            </ul>

        </div>
    </nav>

        <div id="page-wrapper" class="gray-bg">
        <div class="row border-bottom">
        <nav class="navbar navbar-static-top  " role="navigation" style="margin-bottom: 0">
        <div class="navbar-header">
            <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i> </a>
        </div>

        <ul class="nav navbar-top-links navbar-right">
            <li>
                <span class="m-r-sm text-muted welcome-message">
                    Seja bem-vindo ao Dojo do Software.
                </span>
            </li>
            <li>
                <a href="login.html">
                    <i class="fa fa-sign-out"></i> 
                    Sair
                </a>
            </li>
        </ul>

        </nav>
        </div>
            <div class="row wrapper border-bottom white-bg page-heading">
                <div class="col-sm-4">
                    <h2>Projetos</h2>
                    <ol class="breadcrumb">
                        <li>
                            <a href="index.html">Home</a>
                        </li>
                        <li class="active">
                            <strong>Projetos</strong>
                        </li>
                    </ol>
                </div>
            </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="wrapper wrapper-content animated fadeInUp">

                    <div class="ibox">
                        <div class="ibox-title">
                            <h5></h5>
                        </div>
                        <div class="ibox-content">
                            <div class="row m-b-sm m-t-sm">
                                <div class="col-md-12">
                                    <div class="input-group"><input type="text" placeholder="Digite algo, nós encontraremos seu Projeto!" class="input-sm form-control"> <span class="input-group-btn">
                                        <button type="button" class="btn btn-sm btn-primary"> Buscar</button> </span></div>
                                </div>
                            </div>

                            <div class="project-list">

                                <table class="table table-hover">
                                    <tbody id="listagem-de-projetos">
                                        <tr id="linha-template" style="display: none">
                                            <td class="project-status">
                                                <span class="label label-default" 
                                                id="status-projeto-template"></span>
                                            </td>
                                            <td class="project-title">
                                                <a href="project_detail.html"
                                                    id="nome-do-projeto"></a>
                                                <br/>
                                                <small id="data-de-criacao"></small>
                                            </td>
                                            
                                            <td class="project-actions">
                                                <a id="link-de-edicao-de-projeto" 
                                                    data-id-do-projeto="true" 
                                                    href="#" 
                                                    class="js-link-de-edicao-de-projeto btn btn-white btn-sm"
                                                    onclick="editarProjeto(event)">
                                                    <i class="fa fa-folder"></i> 
                                                    Visualizar 
                                                </a>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>



        <div id="div-de-modais">

            <div class="modal inmodal fade in" 
                id="iniciar-um-novo-projeto" 
                tabindex="-1"
                role="dialog" 
                aria-hidden="true" 
                style="display: none;">

                <div class="modal-dialog modal-lg">
                    <div class="modal-content">

                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">
                                <span aria-hidden="true">
                                    ×
                                </span>
                                <span class="sr-only">
                                    Close
                                </span>
                            </button>

                            <h4 class="modal-title">
                                Projeto
                            </h4>
                           <!--  <small class="font-bold">
                                Lorem Ipsum is simply dummy text of the printing and typesetting industry.
                            </small> -->
                        </div>

                        <div class="modal-body">
                            <form>
                                <div role="form">
                                    <div class="form-group">
                                        <label>
                                            Título
                                        </label> 
                                        <input id="titulo-do-projeto" type="text" name="titulo" class="form-control">
                                    </div>

                                    <div class="form-group">
                                        <label>
                                            Resumo
                                        </label> 
                                        <textarea id="resumo-do-projeto" name="resumo" class="form-control"></textarea>
                                    </div>

                                    <div class="form-group">
                                        <label>
                                            Categorias
                                        </label>
                                        <div>
                                            <select data-placeholder=" " class="chosen-select" multiple style="width:350px;" tabindex="4">
                                                <option value="AngularJS">AngularJS</option>
                                                <option value="CSS">CSS</option>
                                                <option value="FireBase">FireBase</option>
                                                <option value="HTML">HTML</option>
                                                <option value="Java">Java</option>
                                                <option value="JavaScript">JavaScript</option>
                                                <option value="NodeJS">NodeJS</option>
                                            </select>
                                        </div>
                                    </div>

                                    <p style="max-width: 100%; margin-bottom: 7px; font-weight: 700;">
                                        Prioridade
                                    </p>
                                    <div class="radio radio-success radio-inline">
                                        <input type="radio" id="inlineRadio1" value="Baixa" name="prioridade" checked="">
                                        <label for="inlineRadio1"> 
                                            Baixa
                                        </label>
                                    </div>
                                    <div class="radio radio-warning radio-inline">
                                        <input type="radio" id="inlineRadio2" value="Media" name="prioridade">
                                        <label for="inlineRadio2"> 
                                            Média 
                                        </label>
                                    </div>
                                    <div class="radio radio-danger radio-inline">
                                        <input type="radio" id="inlineRadio3" value="Alta" name="prioridade">
                                        <label for="inlineRadio3"> 
                                            Alta
                                        </label>
                                    </div>

                                    
                                </div>
                            </form>
                        </div>

                        <div class="modal-footer">
                            <button id="fechar-modal-de-novo-projeto" type="button" class="btn btn-white" data-dismiss="modal">
                                Fechar
                            </button>
                            <button id="salvar-novo-projeto" type="button" class="btn btn-primary">
                                Salvar
                            </button>
                        </div>
                    </div>
                </div>

            </div>

        </div>

        <div class="footer">
            <div class="pull-right">
                Software Livre
            </div>
            <div>
                <strong>Copyright</strong> Dojo do Software &copy; 2017-2017
            </div>
        </div>

        </div>
        </div>

    <!-- Mainly scripts -->
    <script src="js/jquery-3.1.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

    <!-- Custom and plugin javascript -->
    <script src="js/inspinia.js"></script>
    <script src="js/plugins/pace/pace.min.js"></script>

    <!-- Toastr script -->
    <script src="js/plugins/toastr/toastr.min.js"></script>

    <!-- Chosen -->
    <script src="js/plugins/chosen/chosen.jquery.js"></script>

    <!-- Jquery Validate -->
    <script src="js/plugins/validate/jquery.validate.min.js"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/4.5.0/firebase.js"></script>
    <script>

        var config = 
        {
            apiKey: "AIzaSyDOUzqY1e9W76wx_wZz4yZfm6IlP4FzNdQ",
            authDomain: "dojodosoftware.firebaseapp.com",
            databaseURL: "https://dojodosoftware.firebaseio.com",
            projectId: "dojodosoftware",
            storageBucket: "dojodosoftware.appspot.com",
            messagingSenderId: "377101591716"
        };

        firebase.initializeApp(config);

        var database = firebase.database(); 

        $(function (){
            configuracoesIniciaisDaTela();
         
            $("#salvar-novo-projeto").on("click", salvarNovoProjetoAPartirDoUltimoId);
            $("#fechar-modal-de-novo-projeto").on("click", limparCamposDoModalDeNovoProjeto);
        })

        function configuracoesIniciaisDaTela()
        {
            $(".chosen-select").chosen({width: "100%"});
            $("#titulo-do-projeto").focus();
            listarTodosOsProjetos();
        }

        function salvarNovoProjetoAPartirDoUltimoId()
        {

            var proximoId = 0;

            firebase.database().ref('/Projeto').once('value').then(
                function(snapshot) 
                { 
                    if(snapshot.val() != null)
                        proximoId = snapshot.val().length;
                    
                    salvarNovoProjeto(proximoId)
                });
        }

        function salvarNovoProjeto(idDoProjeto)
        {
            var tituloDoProjeto = $("#titulo-do-projeto").val();
            var resumoDoProjeto = $("#resumo-do-projeto").val();
            var dataDeCadastro = new Date().toDateString();
            var status = 'Em Elaboração';
            var porcentagemDeConclusao  = 0;
            var participantes = [{}]
            var prioridade = $("[name=prioridade]:checked").val()

            var estaValido = true;

            if (tituloDoProjeto == '')
            {
                $("#titulo-do-projeto")
                    .addClass('error')
                    .parent('div')
                        .append('<label id="number-error" class="error" for="number">Este campo é obrigatório.</label>');

                estaValido = false
            }

            if(resumoDoProjeto == '')
            {
                $("#resumo-do-projeto")
                    .addClass('error')
                    .parent('div')
                        .append('<label id="number-error" class="error" for="number">Este campo é obrigatório.</label>');
                
                estaValido = false
            }
            
            if (!estaValido) 
            {
                return;
            }

            var categorias = '[';

            $(".search-choice").each(function(index)
            {
                nome = $("span", this).html();

                categorias += '{"nome":"' + nome + '"}';

                if (index != $(".search-choice").length - 1)               
                    categorias += ','
            })

            categorias += ']' 

            var jsonParaSalvarProjeto = 
            {
                "TituloDoProjeto": tituloDoProjeto,
                "ResumoDoProjeto": resumoDoProjeto,
                "DataDeCadastro": dataDeCadastro,
                "Status": status,
                "PorcentagemDeConclusao": porcentagemDeConclusao,
                "Participantes": participantes,
                "Prioridade": prioridade,
                "Categorias": JSON.parse(categorias)
            }

            firebase.database()
                .ref('Projeto/' + idDoProjeto)
                    .set(jsonParaSalvarProjeto);

            renderizarMensagemDeSucesso();
            fecharModalDeNovoProjeto();
            limparCamposDoModalDeNovoProjeto();

            
                window.location.href = "project_detail_of_students.html";
            
        }

        function renderizarMensagemDeSucesso()
        {
            toastr.success('O registro foi salvo com sucesso', 'Ótimo!');
        }

        function fecharModalDeNovoProjeto()
        {
            $("#iniciar-um-novo-projeto").modal('hide');
        }

        function limparCamposDoModalDeNovoProjeto()
        {
            $("#titulo-do-projeto").val('');
            $("#resumo-do-projeto").val('');
        }

        function listarTodosOsProjetos()
        {
            
            firebase.database().ref('/Projeto').once('value').then(
                function(snapshot) 
                { 
                    for(var i = 0; i < snapshot.val().length; i++)
                    {
                        var  projetoDoContexto = snapshot.val()[i];

                        if(projetoDoContexto.Status == "Disponível Para Lance")
                        {
                            localStorage.setItem("idDoProjeto", i);
                            $("#status-projeto-template").html(projetoDoContexto.Status);
                            $("#nome-do-projeto").html(projetoDoContexto.TituloDoProjeto);
                            $("#data-de-criacao").html(projetoDoContexto.DataDeCadastro);
                            $("#link-de-edicao-de-projeto").attr("data-id-do-projeto", i)

                            var htmlDoTemplate = '<tr>' + $("#linha-template").html() + '</tr>';
                            $("#listagem-de-projetos").append(htmlDoTemplate);
                        }
                    }
                });
        }

        function editarProjeto(event)
        {
            $elemento = $(event.srcElement)

            localStorage.setItem("idDoProjeto", $elemento.data("id-do-projeto"));

            window.location.href = '/home/gabrielbressani/Documents/TIS/DojoDoSoftware/project_detail_of_students.html'
        }
    </script>
</body>

</html>
